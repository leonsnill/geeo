# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
#       Geographic and Ecological Earth Observation (GEEO) PARAMETER FILE
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

# Version 1.0
# Leon Nill
# Biogeography Lab, Department of Geography, Humboldt-UniversitÃ¤t zu Berlin
# Contact: leon.nill@geo.hu-berlin.de | GitHub: leonsnill


# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
#                                    LEVEL-2
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||


# -------------------------------------------------------------------------------
#                                 SPACE AND TIME                               
# -------------------------------------------------------------------------------

# Region of Interest (ROI) settings 
# (WGS84) List of point [lon, lat], rectangle [lon, lat, lon, lat], 
# polygon [[lon1, lat1], [lon2, lat2], ..., [lon1, lat1]], or path to vector file.
ROI: [12.9, 52.2, 13.9, 52.7]

# Global time settings
YEAR_MIN: 2023                           # Minimum year
YEAR_MAX: 2023                           # Maximum year
MONTH_MIN: 1                             # Minimum month
MONTH_MAX: 12                            # Maximum month
DOY_MIN: 1                               # Minimum day of year
DOY_MAX: 366                             # Maximum day of year
# alternative - overwrites above:
DATE_MIN: null                           # YYYYMMDD
DATE_MAX: null                           # YYYYMMDD       


# -------------------------------------------------------------------------------
#                        SENSOR AND DATA QUALITY SETTINGS                          
# -------------------------------------------------------------------------------

# Sensors to include
# Landsat 4-9 Level 2, Collection 2, Tier 1; Sentinel-2 Level-2A
# Choosing >1 results in merge into sensor constellation. 
SENSORS:                                 # List of sensors L9, L8, L7, L5, L4, S2
- L9
- L8
- L7
- L5
- L4

EXCLUDE_SLCOFF: false                    # Exclude Landsat-7 ETM+ SLC-off?
GCP_MIN_LANDSAT: 1                       # Min Ground Control Points for Landsat
MAX_CLOUD: 75                            # Maximum cloud cover percentage

# Masking settings
MASKS_LANDSAT:                           # null, cloud, cshadow, snow, fill, dilated, saturated
- cloud
- cshadow
- snow
- fill
- dilated
MASKS_LANDSAT_CONF: Medium               # Confidence level for Landsat masks ('Medium', 'High')
MASKS_S2: CPLUS                          # null, CPLUS, PROB, SCL
MASKS_S2_CPLUS: 0.6                      # CPLUS: Threshold for mask
MASKS_S2_PROB: 30                        # PROB: Probability threshold for mask
MASKS_S2_NIR_THRESH_SHADOW: 0.2          # PROB: Threshold NIR-based shadow mask
ERODE_DILATE: false                      # Erode mask
ERODE_RADIUS: 60                         # Erosion radius (meters)
DILATE_RADIUS: 120                       # Dilation radius (meters)
ERODE_DILATE_SCALE: 90                   # Scale for erode/dilate operations
BLUE_MAX_MASKING: 1                      # Maximum blue reflectance to mask

# -------------------------------------------------------------------------------
#                           BANDS | INDICES | FEATURES
# -------------------------------------------------------------------------------

# Selected bands, indices, and features
# Available bands:
# BLU, GRN, RED, NIR, SW1, SW2 (Landsat+Sentinel-2)
# LST (Landsat, if processed)
# RE1, RE2, RE3, RE4 (Sentinel-2)
# NDVI, EVI, NBR, NDMI, NDWI, MDWI, NDB, TCG, TCB, TCW
FEATURES:
- BLU
- GRN
- RED
- NIR
- SW1
- SW2

# -------------------------------------------------------------------------------
#                                LINEAR UNMIXING
# -------------------------------------------------------------------------------

UMX: null                               # null or dict of endmember name + values {'Class1': [100, 30, 20, ...], 'Class2': [24, ...], ...}
# Unmixing settings
UMX_SUM_TO_ONE: true                     # Sum to one constraint
UMX_NON_NEGATIVE: true                   # Non-negative constraint
UMX_REMOVE_INPUT_FEATURES: true          # Keep only unmixing features / remove input features

# -------------------------------------------------------------------------------
#                            TIME SERIES MOSAIC (TSM)
# -------------------------------------------------------------------------------

# Mosaic images from unique dates to create consistent time series stack
TSM: false                               # Time Series Mosaic (TSM)
# Level-2 output settings
EXPORT_TSM: false                        # Export TSM to Drive / Assets

# -------------------------------------------------------------------------------
#                     GENERAL OUTPUT AND PROJECTION SETTINGS
# -------------------------------------------------------------------------------

# Image settings
PIX_RES: 30                              # Pixel resolution (CRS units)
CRS: null                                # EPSG (e.g. EPSG:4326), WKT, UTM, Mollweide, or null for EPSG:4326               
RESAMPLING_METHOD: null                  # null (nearest neighbour), bilinear, bicubic (cubic convolution)
DATATYPE: int16                          # uint8, int8, uint16, int16, uint32, int32, float, double
DATATYPE_SCALE: 10000                    # Scale factor for data type
NODATA_VALUE: -9999                      # Output no data value
IMG_MAX_XYDIM: 100000                    # Maximum image xy-dim in meters

# General export settings
EXPORT_IMAGE: true                       # Export as image
EXPORT_TABLE: false                      # Export as table per feature
EXPORT_DESC: GEEO                        # Image description appended to filenames
EXPORT_DESC_DETAIL_TIME: false           # Append detailed time description (level-3 only, see folding)
EXPORT_LOCATION: Drive                   # Drive, Asset
EXPORT_FOLDER: null                      # Output folder in Drive / assetId
EXPORT_BANDNAMES_AS_CSV: false           # Soft requirement for n-bands > 100
EXPORT_TABLE_METHOD: reduceRegions       # 'reduceRegions' or 'reduceRegion'
EXPORT_TABLE_BUFFER: null                # Buffer for features before reduction (meters)
EXPORT_TABLE_REDUCER: first              # Reducer used to extract values
EXPORT_TABLE_DROP_NODATA: true           # Drop nodata rows from table


# Image export structure
EXPORT_PER_FEATURE: false                # Export separate img per feature/band
EXPORT_PER_TIME: false                   # Export separate img per time (WARNING!)


# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
#                                  LEVEL-3
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# -------------------------------------------------------------------------------
#                         TEMPORAL SUBWINDOWS | FOLDING                               
# -------------------------------------------------------------------------------

# Simple calendar-based folding
FOLD_YEAR: false                         # Annual folding, i.e. calculations per year within YEAR_MIN and YEAR_MAX
FOLD_MONTH: false                        # Monthly folding, i.e. calculations per month within MONTH_MIN and MONTH_MAX

# Custom folding
FOLD_CUSTOM: {
  year: null,                            # null, list of year range ([2020-2021, 2023-2024]), or year target and offset ([2020+-1, 2023+-1])
  month: null,                           # null, list of month range ([01-03, 06-09]), or month target and offset ([01+-1, 06+-1])
  doy: null,                             # null, list of day of year range ([001-100, 200-300]), or doy target and offset ([001+-100, 200+-100])
  date: null                             # null, list of date range ([20200101-20200301, 20200601-20200901]), or date target and offset ([20200101+-100, 20200601+-100])
}                 

# A range or target that can be combined into truly adjacent date ranges are generally more efficient because it allows for using ee.Joins server-side operations.
# For example, filtering for a year range from 2014-2016 AND a month range 5-11 is less efficient because it excludes certain months across years which 
# requires creating an ee.List object and subsequent .map() over a list compared to cases where dates are not exclusive, e.g. FOLD_YEAR = true AND month range 5-11.


# -------------------------------------------------------------------------------
#                        TIME SERIES INTERPOLATION (TSI)
# -------------------------------------------------------------------------------
# Time Series Interpolation (TSI) method
TSI: null                                # null, WLIN, 1RBF, 2RBF, 3RBF  
TSI_BASE_IMGCOL: TSS                     # TSS, TSM

# Interpolation settings
INTERVAL: 16                             # Interpolation interval (days)
INIT_JANUARY_1ST: false                  # Initialize interval on Jan 1st
SIGMA1: 16                               # Sigma1 of RBF function
SIGMA2: 32                               # Sigma2 of RBF function
SIGMA3: 64                               # Sigma3 of RBF function
WIN1: 16                                 # Window1 for RBF
WIN2: 32                                 # Window2 for RBF
WIN3: 64                                 # Window3 for RBF
BW1: 4                                   # Weight for WIN1
BW2: 8                                   # Weight for WIN2

# Export TSI to Drive / Asset
EXPORT_TSI: false                        # Export TSI image/table


# -------------------------------------------------------------------------------
#                        SPECTRAL TEMPORAL METRICS (STM)
# -------------------------------------------------------------------------------
# Spectral-Temporal Metrics (STMs) settings
STM: null                                # null or list of metrics
# ['min', 'p5', 'p10', 'p15', ..., 'p95', 'max', 'mean', 'median', 'stdDev', 
# 'variance', 'skew', 'kurtosis']
STM_BASE_IMGCOL: TSS                     # TSS, TSM, TSI

# Folding: temporal subwindows
STM_FOLDING: false                       # adopt folding settings from above

# Export STM to Drive / Asset
EXPORT_STM: false                        # Export STM image/table


# -------------------------------------------------------------------------------
#                        PIXEL-BASED COMPOSITING (PBC)
# -------------------------------------------------------------------------------
# Pixel-Based Compositing (PBC) settings
PBC: null                                # null, FEATURE (e.g. NDVI, NBR), BAP, MAX-RNB, NLCD
PBC_BASE_IMGCOL: TSS                     # TSS, TSM, TSI

# PBC settings
# PBC uses ee.ImageCollection.qualityMosaic()
PBC_INVERT_QUALITY_METRIC: false         # invert if FEATURE is selected where minima refer to better quality

# Best-available-pixel (BAP, Griffiths et al. 2013)            
PBC_BAP_DOY_EQ_YEAR: 30                  # doy offset at which score equals score of image +-1 year
PBC_BAP_MAX_CLOUDDISTANCE: 500           # cloud distance in meters at which cloud_score = 1
PBC_BAP_MIN_CLOUDDISTANCE: 0             # cloud distance in meters at which cloud_score = 0
PBC_BAP_WEIGHT_DOY: 0.6                  # weight for doy-score (seasonal consistency)
PBC_BAP_WEIGHT_YEAR: 0.2                 # weight for year-score (annual consistency)
PBC_BAP_WEIGHT_CLOUD: 0.2                # weight for cloud-score

# Export PBC to Drive / Asset
EXPORT_PBC: false                        # Export PBC image/table


# -------------------------------------------------------------------------------
#                              TREND ANALYSIS
# -------------------------------------------------------------------------------
# Linear Trend Analysis settings
TREND: false  # Linear Trend Analysis ('OLS' or 'TS')
EXPORT_TREND: false  # Export trend image?
