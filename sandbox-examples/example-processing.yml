# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
#       Geographic and Ecological Earth Observation (GEEO) PARAMETER FILE
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

# Version 1.0
# Leon Nill
# Biogeography Lab, Department of Geography, Humboldt-UniversitÃ¤t zu Berlin
# Contact: leon.nill@geo.hu-berlin.de | GitHub: leonsnill


# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
#                                    LEVEL-2
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
# ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||


# -------------------------------------------------------------------------------
#                                 SPACE AND TIME                               
# -------------------------------------------------------------------------------

# Region of Interest (ROI) settings 
# (WGS84) List of point [lon, lat], rectangle [lon, lat, lon, lat], 
# polygon [[lon1, lat1], [lon2, lat2], ..., [lon1, lat1]], or path to vector file.
ROI: C:/Users/Leon/Desktop/WDPA_Gorongosa-core_WGS84_sample.gpkg

# Global time settings
YEAR_MIN: 2023                           # Minimum year
YEAR_MAX: 2023                           # Maximum year
MONTH_MIN: 1                             # Minimum month
MONTH_MAX: 12                            # Maximum month
DOY_MIN: 1                               # Minimum day of year
DOY_MAX: 366                             # Maximum day of year
# alternative - overwrites above:
DATE_MIN: null                           # YYYYMMDD
DATE_MAX: null                           # YYYYMMDD       


# -------------------------------------------------------------------------------
#                        SENSOR AND DATA QUALITY SETTINGS                          
# -------------------------------------------------------------------------------

# Sensors to include
# Landsat 4-9 Level 2, Collection 2, Tier 1; Sentinel-2 Level-2A
# Choosing >1 results in merge into sensor constellation. 
SENSORS:                                 # List of sensors L9, L8, L7, L5, L4, S2
- L9
- L8
- L7
- L5
- L4

EXCLUDE_SLCOFF: true                    # Exclude Landsat-7 ETM+ SLC-off?
GCP_MIN_LANDSAT: 1                       # Min Ground Control Points for Landsat
MAX_CLOUD: 75                            # Maximum cloud cover percentage

# Masking settings
MASKS_LANDSAT:                           # null, cloud, cshadow, snow, fill, dilated, saturated
- cloud
- cshadow
- snow
- fill
- dilated
MASKS_LANDSAT_CONF: Medium               # Confidence level for Landsat masks ('Medium', 'High')
MASKS_S2: CPLUS                          # null, CPLUS, PROB, SCL
MASKS_S2_CPLUS: 0.6                      # CPLUS: Threshold for mask
MASKS_S2_PROB: 30                        # PROB: Probability threshold for mask
MASKS_S2_NIR_THRESH_SHADOW: 0.2          # PROB: Threshold NIR-based shadow mask
ERODE_DILATE: true                             # Erode mask
ERODE_RADIUS: 90                         # Erosion radius (meters)
DILATE_RADIUS: 360                       # Dilation radius (meters)
ERODE_DILATE_SCALE: 90                         # Scale for erode/dilate operations
BLUE_MAX_MASKING: null                      # Maximum blue reflectance to mask

# -------------------------------------------------------------------------------
#                           BANDS | INDICES | FEATURES
# -------------------------------------------------------------------------------

# Selected bands, indices, and features
# Available bands:
# BLU, GRN, RED, NIR, SW1, SW2 (Landsat+Sentinel-2)
# RE1, RE2, RE3, RE4 (Sentinel-2)
# NDVI, EVI, NBR, NDMI, NDWI, MDWI, NDB, TCG, TCB, TCW
FEATURES: [BLU, GRN, RED, NIR, SW1, SW2]

# -------------------------------------------------------------------------------
#                            TIME SERIES MOSAIC (TSM)
# -------------------------------------------------------------------------------

# Mosaic images from unique dates to create consistent time series stack
TSM: true                               # Time Series Mosaic (TSM)
# Level-2 output settings
EXPORT_TSM: false                        # Export TSM to Drive / Assets

# -------------------------------------------------------------------------------
#                     GENERAL OUTPUT AND PROJECTION SETTINGS
# -------------------------------------------------------------------------------

# Image settings
PIX_RES: 30                              # Pixel resolution (CRS units)
CRS: UTM                                 # EPSG, WKT, UTM, or null (WGS84)                    
RESAMPLING_METHOD: bilinear              # null (NN), bilinear, cubic
DATATYPE: int16                          # uint8, int8, uint16, int16, uint32, int32, flt32, flt64
DATATYPE_SCALE: 10000                    # Scale factor for data type
NODATA_VALUE: -9999                      # Output no data value
IMG_MAX_XYDIM: 100000                    # Maximum image xy-dim in meters

# General export settings
EXPORT_IMAGE: false                       # Export as image
EXPORT_TABLE: true                      # Export as table per feature
EXPORT_DESC: 'BERLIN_V7'                      # Image description appended to filenames
EXPORT_DESC_DETAIL_TIME: false           # Append detailed time description
EXPORT_LOCATION: Drive                   # Drive, Asset
EXPORT_FOLDER: null                      # Output folder in Drive / assetId
EXPORT_BANDNAMES_AS_CSV: false           # Soft requirement for n-bands > 100
EXPORT_TABLE_METHOD: reduceRegions       # 'reduceRegions' or 'reduceRegion'
EXPORT_TABLE_BUFFER: null                # Buffer in meters before reduction
EXPORT_TABLE_REDUCER: first            # Reducer used to extract values

# Image export structure
EXPORT_PER_FEATURE: false                # Export separate img per feature/band
EXPORT_PER_TIME: false                   # Export separate img per time (WARNING!)


# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
#                                  LEVEL-3
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# -------------------------------------------------------------------------------
#                                   FOLDING                               
# -------------------------------------------------------------------------------
# Folding (temporal sub-windows)
# Simple calendar-based folding
FOLD_YEAR: false                     # Annual folding
FOLD_MONTH: false                    # Monthly folding
# Custom folding
FOLD_CUSTOM: {range: [1-5, 6-11], type: month}                    # {range: [start-end, ...], type: month|year|doy|date}
# Examples:
# {range: [1-3, 4-6, 7-9, 10-12], type: month}
# {range: [2020-2021, 2023-2024], type: year}
# {range: [1-180, 181-366], type: doy}
# {range: [20200601-20220601, 20210601-20230601], type: date}               

# -------------------------------------------------------------------------------
#                                LINEAR UNMIXING
# -------------------------------------------------------------------------------
# Unmixing settings
UNX: false  # Unmixing?
UNX_ENDMEMBERS: {}  # Endmembers for unmixing
UNX_KWARGS:
sumToOne: true  # Sum to one constraint
nonNegative: true  # Non-negative constraint
UNX_REMOVE_INPUT_FEATURES: true  # Remove input features after unmixing?


# -------------------------------------------------------------------------------
#                        TIME SERIES INTERPOLATION (TSI)
# -------------------------------------------------------------------------------
# Time Series Interpolation (TSI) method
TSI: 2RBF                                # null, WLIN, 1RBF, 2RBF, 3RBF  
TSI_BASE_IMGCOL: TSS                      # TSS, TSM

# Interpolation settings
INTERVAL: 16                             # Interpolation interval (days)
INIT_JANUARY_1ST: false                  # Initialize interval on Jan 1st
SIGMA1: 16                               # Sigma1 of RBF function
SIGMA2: 32                               # Sigma2 of RBF function
SIGMA3: 64                               # Sigma3 of RBF function
WIN1: 16                                 # Window1 for RBF
WIN2: 32                                 # Window2 for RBF
WIN3: 64                                 # Window3 for RBF
BW1: 4                                   # Weight for WIN1
BW2: 8                                   # Weight for WIN2

# Export TSI to Drive / Asset
EXPORT_TSI: false                        # Export TSI image/table


# -------------------------------------------------------------------------------
#                        SPECTRAL TEMPORAL METRICS (STMs)
# -------------------------------------------------------------------------------
# Spectral-Temporal Metrics (STMs) settings
STM: [min]                                # null or list of metrics
# [min, p5, p10, p15, ..., p95, max, mean, median, std, 
# var, skew, kurtosis]
STM_BASE_IMGCOL: TSS                     # TSS, TSM, TSI

# Folding: temporal subwindows
STM_FOLDING: false                       # adopt folding settings from above

# Export STM to Drive / Asset
EXPORT_STM: true                        # Export STM image/table

STM_EXPLODE_TIME: false  # Explode STMs over time?
STM_EXPLODE_FEAT: false  # Explode STMs over features?


# -------------------------------------------------------------------------------
#                        PIXEL-BASED COMPOSITING (PBC)
# -------------------------------------------------------------------------------
# Pixel-Based Compositing (PBC) settings
PBC: false  # Pixel-Based Compositing (PBC) feature
PBC_EXPORT: false  # Export PBC image?
PBC_ANNUAL: false  # Annual PBC?
PBC_NEGATIVE_MULTIPLIER: false  # Negative multiplier for PBC?
PBC_TSI: false  # Time Series Interpolation for PBC?

# -------------------------------------------------------------------------------
#                              TREND ANALYSIS
# -------------------------------------------------------------------------------
# Linear Trend Analysis settings
TREND: false  # Linear Trend Analysis ('OLS' or 'TS')
EXPORT_TREND: false  # Export trend image?
